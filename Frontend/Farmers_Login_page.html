<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Registration/Login</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>

<style>
    .form-container {
        max-width: 400px;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
        background: #208a25;
    }
</style>

</head>
<body>

<h1 class="text-center mt-5">AgriBazaar</h1>

<ul class="nav nav-tabs justify-content-center mt-4">
    <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#login">Login</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#register">Registration</a>
    </li>
</ul>

<div class="tab-content form-container">
    <!-- Login tab -->
    <div id="login" class="tab-pane fade show active">
        <h4>Login</h4>
        <form id="loginForm">
            <div class="mb-3">
                <label for="loginEmail" class="form-label">Email</label>
                <input id="loginEmail" type="email" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="loginPassword" class="form-label">Password</label>
                <input id="loginPassword" type="password" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
        </form>
    </div>

    <!-- Registration tab -->
    <div id="register" class="tab-pane fade">
        <h4>Registration</h4>
        <form id="userRegisterForm">
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input id="email" type="email" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input id="password" type="password" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <input id="confirmPassword" type="password" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Register</button>
        </form>
    </div>
</div>

<script>
    // Registration Validation and AJAX submission
    $("#userRegisterForm").submit(function (e) {
        e.preventDefault();

        let email = $("#email").val().trim();
        let password = $("#password").val().trim();
        let confirmPassword = $("#confirmPassword").val().trim();
        let error = "";

        if (!(/^[\w.-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email))) {
            error = "Invalid email format.";
        } else if (password.length < 6) {
            error = "Password too weak, minimum 6 chars.";
        } else if (!/\d/.test(password) ||
                   !/[!@#$%^&*]/.test(password)) {
            error = "Password must contain a number and a symbol.";
        } else if (password !== confirmPassword) {
            error = "Passwords do not match.";
        }

        if (error !== "") {
            alert(error);
        } else {
            $.ajax({ 
                url: "/api/user/register", // Change to your API endpoint
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ email, password }),
                success: function (res) {
                    console.log("Registered!", res);
                    alert("Registration successful!");
                },
                error: function (err) {
                    console.error(err);
                    alert("Registration failed!");
                }
            });
        }
    });

    // Login submission
    $("#loginForm").submit(function (e) {
        e.preventDefault();

        let email = $("#loginEmail").val().trim();
        let password = $("#loginPassword").val().trim();

        if (email.length === 0) {
            alert("Email cannot be empty.");
            return;
        }
        if (password.length < 6) {
            alert("Password must be minimum 6 chars.");
            return;
        }

        // Perform your AJAX call here if needed
        console.log("Login with", email, password);
        alert("Login successful!");
    });
</script>

</body>
</html>
